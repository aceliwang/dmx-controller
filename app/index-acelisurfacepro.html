<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href=".\skeleton.css">
    <link rel="stylesheet" href=".\style.css">
    <!-- <script type="text/javascript" src="/eel.js"></script> -->
</head>

<body>
    <div class="container">
        <div class="row">
            <div id="palettes"></div>
        </div>
        <div id="log"></div>
        <div id="cuelist"><h1>cue list</h1></div>
        <div id="timeline">
            <!-- cue needs to be in columns -->
            <!-- groups needs to be in rows -->
        </div>
        <div class="row">
            <input id="input" class="ten columns u-full-width" type="text">
            <input id="submit" class="two columns u-full-width" type="submit" value="Submit">
        </div>
    </div>
</body>
<script>
    let paletteDiv = document.getElementById('palettes')
    let logDiv = document.getElementById('log')
    let input = document.getElementById('input')
    // eel.expose(populateGroups)
    function paletteBlock(name, colour) {
        function convertArrayToColour(array) {
            string = `rgb(${array[0]},${array[1]},${array[2]})`
            console.log(string);
            return string
        }
        let block = document.createElement('div')
        block.className = 'paletteBlock'
        block.style.backgroundColor = convertArrayToColour(colour)
        block.onclick = function () {
            input.value += `${type} ${name} `
        }
        let label = document.createElement('div')
        label.style.backgroundColor = 'black'
        label.style.color = 'white'
        label.innerText = name
        block.appendChild(label)
        return block
    }
    async function populateGroups() {
        let palettes = await eel.palette()()
        groups = palettes.groups
        console.log(palettes)
        delete palettes.groups
        for (group in groups) {
            text = document.createTextNode(group + ': ' + JSON.stringify(groups[group]))
            paletteDiv.appendChild(text)
        }
        for (palette in palettes) {
            palette = palettes[palette]
            for (name in palette) {
                let def = palette[name].default
                console.log(def)
                paletteDiv.appendChild(paletteBlock(name, def))
                text = document.createTextNode(name + '\n')
                paletteDiv.appendChild(text)
                text = document.createTextNode(JSON.stringify(def))
                paletteDiv.appendChild(text)
                let types = palette[name]['fixture types']
                for (type in types) {
                    text = document.createTextNode(JSON.stringify(type))
                    paletteDiv.appendChild(text)
                }
                let fixtures = palette[name].fixtures
                for (fixture in fixtures) {
                    text = document.createTextNode(JSON.stringify(fixture))
                    paletteDiv.appendChild(text)
                }

            }

        }

    }
    let timeline = document.getElementById('timeline')
    let cuelist = document.getElementById('cuelist')
    function fillTimeline() {
        // let cueLists = await eel.cuelists()()
        let None = ''
        cueLists = {
            'mainCueList': [
                {
                    'name': 'beat',
                    'desc': 'pars flash',
                    'timing': 'manual',
                    'commands': 'pars on',
                    'dmx': {
                        101: [255, 0],
                    },
                    // 'dmx': [[101, 255, 0], [102, 255, 0], [102, 0, 2, 'delay']],
                    'state': [None, None, None]
                },
                {
                    'name': 'beat',
                    'desc': 'pars flash',
                    'timing': 'follow',
                    'dmx': [[101, 0, 0]],
                    'state': [None, None]
                }
            ]
        }
        lists = cueLists.cue_lists
        lists = cueLists
        patching = {
            101: [219, 'trimmer par'],
            102: [8, 'trimmer par']
        }
        for (list in lists) {
            // list = mainCueList
            console.log(list)
            let cueHeaderGroup = document.createElement('div')
            cueHeaderGroup.className = 'cueGroup'
            for (light in patching) {
                let cueItem = document.createElement('div')
                cueItem.className = 'cueHeader'
                cueItem.innerText = light
                cueHeaderGroup.appendChild(cueItem)
                
            }
            timeline.appendChild(cueHeaderGroup)
            for (cue of lists[list]) { // going through the cue list
                console.log(cue);
                // cue = cue object
                let name = cue.name
                let desc = cue.desc
                let timing = cue.timing
                let commands = cue.commands
                let dmx = cue.dmx
                let state = cue.state
                let cueRow = document.createElement('div')
                cueRow.className = 'cueRow'
                cueRow.innerText = `${name}, ${desc}, ${timing}, ${commands}, ${dmx}, ${state}`
                cuelist.appendChild(cueRow)
                // TODO: resizable divs
                let cueGroup = document.createElement('div')
                cueGroup.className = 'cueGroup'
                lightsInCue = cue.dmx.keys // TODO: properties
                for (light in patching) {
                    console.log(light, 'light');
                    let cueItem = document.createElement('div')
                    cueItem.className = 'cueItem'
                    if (light in lightsInCue) {
                        // how to do a javascript lookup
                        // backgroundColour = default
                        cueItem.style.backgroundColor = 'white'
                    }
                    cueGroup.appendChild(cueItem)
                }
                console.log(cueGroup)
                timeline.appendChild(cueGroup)
                console.log('hi', cue.dmx);
                

            }
        }
    }
    // populateGroups()
    fillTimeline()
    let inputBtn = document.getElementById('submit')
    inputBtn.onclick = function handleSubmit() {
        console.log(input.value)
        eel.read_line(input.value)
        let text = document.createTextNode(input.value)
        logDiv.appendChild(text)
        input.value = ''
        return
    }
</script>

</html>