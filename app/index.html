<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Lighting Script</title>
    <link rel="stylesheet" href=".\skeleton.css">
    <link rel="stylesheet" href=".\style.css">
    <script type="text/javascript" src="/eel.js"></script>
    <script src="https://unpkg.com/wavesurfer.js"></script>

</head>

<body>
    <div class="container">
        <div class="row">
            <div id="palettes"></div>
        </div>
        <div id="log"></div>
        <h1 id="trigger">TRIGGER</h1>
        <div id="cuelist">
            <div>Number, Name, Command, Timing, Commands, State</div>
            <h1>cue list</h1>
            <button id="timecode-toggle">timecode: starts at any cue</button>
            <button>link to audio</button> 
            <!-- TODO ABOVE -->
        </div>
        <div id="timeline">
            <!-- cue needs to be in columns -->
            <!-- groups needs to be in rows -->
        </div>
        <div id="programmer">
            <h1>programmer</h1>
            <span>active cuelist: <span id="active-cuelist"></span></span><br>
            <span>active selection: <span id="active-selection"></span></span><br>
            <span>currently selected: </span><br>
            <span>selected cues: </span><span id="selected-cues"></span><br>
            <span>intensity</span><span id="intensity"></span>
            <span>hue</span>
            <span>saturation</span>
            <span>buttons = scroll, mouse movements, switch to dmx/palette/value, empty</span>
            <div id="programmed"></div>
            <div id="parameters">
                <input type="color">
                <div class="parameterProgrammer">
                    <span class="parameterLabel">Intensity</span>
                    <span class="parameterValue"><input class="parameterValue" type="text" name="intensity" /></span>
                </div>
                <div class="parameterProgrammer">
                    <span class="parameterLabel">Hue</span>
                    <span class="parameterValue"><input class="parameterValue" type="text" /></span>
                </div>
                <div class="parameterProgrammer">
                    <span class="parameterLabel">Saturation</span>
                    <span class="parameterValue"><input class="parameterValue" type="text" /></span>
                </div>
                <div class="parameterProgrammer">
                    <span class="parameterLabel">Pan</span>
                    <span class="parameterValue"><input class="parameterValue" type="text" /></span>
                </div>
                <div class="parameterProgrammer">
                    <span class="parameterLabel">Tilt</span>
                    <span class="parameterValue"><input class="parameterValue" type="text" /></span>
                </div>
            </div>
            <input type="button" value="Record to cuelist" onclick="record_cue" />
            <!-- <div id="position-programmer">POSTIION PROGRAMMER</div> -->
        </div>
        <div id="patching">
            <h1>patching</h1>
            <div id="universe-01"></div>
        </div>
        Install drivers from: https://ftdichip.com/drivers/d2xx-drivers/. Download as executable
    Give an & to split lines
    </div>
    
    <div class="row" id="terminal">
        <input id="input" class="ten columns u-full-width" type="text">
        <input id="submit" class="two columns u-full-width" type="submit" value="Submit">
        <div>
            <button id="patching-toggle">patching</button>
            <button id="cuelist-toggle">cuelist</button>
            <button id="programmer-toggle">programmer</button>
            <button id="log-toggle">log</button>
        </div>
    </div>
</body>
<script type="text/javascript" src=".\script.js"></script>
<script>
    let paletteDiv = document.getElementById('palettes')
    let logDiv = document.getElementById('log')
    let input = document.getElementById('input')
    // eel.expose(populateGroups)
    function paletteBlock(name, colour, command) {
        function convertArrayToColour(array) {
            string = `rgb(${array[0]},${array[1]},${array[2]})`
            console.log(string);
            return string
        }
        let block = document.createElement('div')
        block.className = 'paletteBlock'
        block.style.backgroundColor = convertArrayToColour(colour)
        block.onclick = function () {
            if (Object.keys(selected_cues).length > 0) {input.value += `${command} ${name} `}
        }
        let label = document.createElement('div')
        label.style.backgroundColor = 'black'
        label.style.color = 'white'
        label.innerText = name
        block.appendChild(label)
        return block
    }
    async function populateGroups() {
        let palettes = await eel.get_palette()()
        groups = palettes.groups
        console.log(palettes)
        delete palettes.groups
        for (group in groups) {
            text = document.createTextNode(group + ': ' + JSON.stringify(groups[group]))
            paletteDiv.appendChild(text)
        }
        let commandDict = {
            'colour': 'sc'
        }
        for (palette in palettes) {
            command = commandDict[palette]
            palette = palettes[palette]
            for (name in palette) {
                let def = palette[name].default
                console.log(def)
                paletteDiv.appendChild(paletteBlock(name, def, command))
                text = document.createTextNode(name + '\n')
                // paletteDiv.appendChild(text)
                text = document.createTextNode(JSON.stringify(def))
                // paletteDiv.appendChild(text)
                let types = palette[name]['fixture types']
                for (type in types) {
                    text = document.createTextNode(JSON.stringify(type))
                    // paletteDiv.appendChild(text)
                }
                let fixtures = palette[name].fixtures
                for (fixture in fixtures) {
                    text = document.createTextNode(JSON.stringify(fixture))
                    // paletteDiv.appendChild(text)
                }

            }

        }

    }
    let timeline = document.getElementById('timeline')
    let cuelist = document.getElementById('cuelist')
    let humanDMX = new Array(512).fill(null)
    humanDMX[1] = [101, 'intensity']
    humanDMX[9] = [102, 'intensity']
    patching = {
        101: [1, 'trimmer par'],
        102: [9, 'trimmer par']
    }
    function refresh_humanDMX() {
        for (fixture in patching) {
            let [address, fixtureType] = patching[fixture]

        }
    }

    select_cuelist()
    populateGroups()
</script>

</html>